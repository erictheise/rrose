<!doctype html>
<html xmlns="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Rrose by erictheise</title>

    <script src="http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"></script>
    <script src="javascripts/graticule.js"></script>
    <script src="javascripts/rrose-src.js"></script>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
    <link rel="stylesheet" href="stylesheets/leaflet.rrose.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="leaflet.ie.css" />
      <link rel="stylesheet" href="leaflet.rrose.ie.css" />
    <![endif]-->

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Rrose</h1>
        <p>Rrose: A Leaflet Plugin for Edge Cases</p>

        <p class="view"><a href="https://github.com/erictheise/rrose">View the Project on GitHub <small>erictheise/rrose</small></a></p>

        <ul>
          <li><a href="https://github.com/erictheise/rrose/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/erictheise/rrose/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/erictheise/rrose">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>What is this?</h3>

          <p>
              <b>Rrose</b> is a plugin for the <a href="http://leafletjs.com/">Leaflet JavaScript Mapping Library</a>.
              It's useful when you want popups to respond to the <i>mouseover</i> event, but the behavior associated
              with <i>autoPan</i> is getting in your way.
          </p>

          <p>
              Here's a typical Leaflet map. If you click on the map, you get a popup containing a random word
              (courtesy <a href="http://wordnik.com/">Wordnik</a>). Note that when you click close to the top,
              left, or right side of the map, the map
              moves to accommodate the space required to display the popup. This is <i>autoPan</i>, one of the awesome
              features built into the Leaflet library that makes maps look good from the git-go.
          </p>

          <div id="default_map" style="height:400px; width:400px; margin-bottom: 20px;"></div>
          <script type="text/javascript">
              var default_map = L.map('default_map').setView([0.0, 0.0], 2);
              L.tileLayer('images/tiles/{z}/{x}/{y}.png', {
                  minZoom: 1,
                  maxZoom: 4
              }).addTo(default_map);
              var default_geoj = new L.GeoJSON( graticule, {
                  style: function(feature){ return feature.properties.style },
                  onEachFeature: function(feature,layer){
                      layer.on('click',function(e) {
                          var popup_bubble = new L.Popup()
                                  .setContent(feature.properties.name)
                                  .setLatLng(e.latlng)
                                  .openOn(default_map);
                      });
                  }
              }).addTo(default_map);
          </script>

          <p>
              But suppose you'd like popups to respond to <i>mouseover</i>, so that you can quickly scan the shortlist of a map's 
              attributes, reserving the <i>click</i> event to display the details.  In this case, autoPan ceases being 
              your friend; mousing over the top, left, or right side of the map can kick off an escalator ride as autoPan
              clears room for your popup, leaving you in a new region, which triggers a new popup, & so on.  It makes your
              map feel jittery and out of control.
          </p>

          <div id="escalator_map" style="height:400px; width:400px; margin-bottom: 20px;"></div>
          <script type="text/javascript">
              var escalator_map = L.map('escalator_map').setView([-60.0, -25.0], 2);
              L.tileLayer('images/tiles/{z}/{x}/{y}.png', {
                  minZoom: 1,
                  maxZoom: 4
              }).addTo(escalator_map);
              var escalator_geoj = new L.GeoJSON( graticule, {
                  style: function(feature){ return feature.properties.style },
                  onEachFeature: function(feature,layer){
                      layer.on('click',function(e) {
                          escalator_map.closePopup();
                          return true;
                      });
                      layer.on('mouseover', function(e){
                          var hover_bubble = new L.Popup({ offset: new L.Point(0,-10), closeButton: false, autoPan: true })
                                  .setContent(feature.properties.name)
                                  .setLatLng(e.latlng)
                                  .openOn(escalator_map);
                      });
                      layer.on('mouseout', function(e){ escalator_map.closePopup() });
                  }
              }).addTo(escalator_map);
          </script>

          <p>
              Setting <b>autoPan : false</b> triggers a different problem; popups at the top, left, or right edge of the
              map end up offscreen, unreadable.
          </p>

          <div id="offscreen_map" style="height:400px; width:400px; margin-bottom: 20px;"></div>
          <script type="text/javascript">
              var offscreen_map = L.map('offscreen_map').setView([-60.0, -25.0], 2);
              L.tileLayer('images/tiles/{z}/{x}/{y}.png', {
                  minZoom: 1,
                  maxZoom: 4
              }).addTo(offscreen_map);
              var offscreen_geoj = new L.GeoJSON( graticule, {
                  style: function(feature){ return feature.properties.style },
                  onEachFeature: function(feature,layer){
                      layer.on('click',function(e) {
                          offscreen_map.closePopup();
                          return true;
                      });
                      layer.on('mouseover', function(e){
                          var hover_bubble = new L.Popup({ offset: new L.Point(0,-10), closeButton: false, autoPan: false })
                                  .setContent(feature.properties.name)
                                  .setLatLng(e.latlng)
                                  .openOn(offscreen_map);
                      });
                      layer.on('mouseout', function(e){ offscreen_map.closePopup() });
                  }
              }).addTo(offscreen_map);
          </script>

          <p>
              This is the problem that <b>Rrose</b> aims to solve.  What we would like is for the popup to appear under 
              (south of) the point when we're too close to the top, and for it to appear to the left or right (west or 
              east of) the point when we're too close to the sides.  The scheme looks something like a 
              <a href="http://en.wikipedia.org/wiki/Compass_rose">compass rose</a>, and the plugin takes its name from 
              Marcel Duchamp's alter ego, <a href="http://en.wikipedia.org/wiki/Rrose_Selavy">Rrose SÃ©lavy</a>:
          </p>

        <div id="rrose" style="width: 400px; height: 522px; margin-bottom:20px; background-image: url(images/Rrose_Selavy.jpg)">

            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 8px 0px 0px 10px;">
                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-ese">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-ese"></div>
                </div>

                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-ese">
                    <div class="leaflet-rrose-content">sse/ese</div>
                </div>
            </div>

            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 8px 0px 0px 176px;">
                <div class="leaflet-rrose-tip-container">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-s"></div>
                </div>

                <div class="leaflet-rrose-content-wrapper">
                    <div class="leaflet-rrose-content">s</div>
                </div>
            </div>

            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 8px 0px 0px 299px;">
                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-ssw">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-ssw"></div>
                </div>

                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-ssw">
                    <div class="leaflet-rrose-content">ssw/wsw</div>
                </div>
            </div>


            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 140px 0px 0px 10px;">
                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-e">
                    <div class="leaflet-rrose-content">e</div>
                </div>

                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-e">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-e"></div>
                </div>
            </div>


            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 140px 0px 0px 339px;">
                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-w">
                    <div class="leaflet-rrose-content">w</div>
                </div>

                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-w">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-w"></div>
                </div>
            </div>


            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 448px 0px 0px 10px;">
                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-nne">
                    <div class="leaflet-rrose-content">nne/ene</div>
                </div>

                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-nne">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-nne"></div>
                </div>
            </div>

            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 448px 0px 0px 176px;">
                <div class="leaflet-rrose-content-wrapper">
                    <div class="leaflet-rrose-content">n</div>
                </div>

                <div class="leaflet-rrose-tip-container">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-n"></div>
                </div>
            </div>

            <div class="leaflet-rrose leaflet-zoom-animated" style="margin: 448px 0px 0px 299px;">
                <div class="leaflet-rrose-content-wrapper leaflet-rrose-content-wrapper-wnw">
                    <div class="leaflet-rrose-content">nnw/wnw</div>
                </div>

                <div class="leaflet-rrose-tip-container leaflet-rrose-tip-container-wnw">
                    <div class="leaflet-rrose-tip leaflet-rrose-tip-wnw"></div>
                </div>
            </div>

        </div>

        <p>
            This behavior will be familiar to you if you've worked with popups in 
            <a href="http://openlayers.org/">OpenLayers</a> or other mapping libraries.  Here it is in
            action:
        </p>

          <div id="rrose_map" style="height:400px; width:400px; margin-bottom: 20px;"></div>
          <script type="text/javascript">
              var rrose_map = L.map('rrose_map').setView([0.0, 0.0], 2);
              L.tileLayer('images/tiles/{z}/{x}/{y}.png', {
                  minZoom: 1,
                  maxZoom: 4
              }).addTo(rrose_map);
              var rrose_geoj = new L.GeoJSON( graticule, {
                  style: function(feature){ return feature.properties.style },
                  onEachFeature: function(feature,layer){
                      layer.on('click',function(e) {
                          rrose_map.closePopup();
                          return true;
                      });
                      layer.on('mouseover', function(e){
                          var hover_bubble = new L.Rrose({ offset: new L.Point(0,-10), closeButton: false, autoPan: false })
                                  .setContent(feature.properties.name)
                                  .setLatLng(e.latlng)
                                  .openOn(rrose_map);
                      });
                      layer.on('mouseout', function(e){ rrose_map.closePopup() });
                  }
              }).addTo(rrose_map);
          </script>

        <p>
            It looks good in Chrome, FireFox, Safari, Opera, and IE 9, less good in IE 8, don't yet know about earlier.
        </p>

        <h3>Using it</h3>
        
        <p>
            Drop <code>rrose-src.js</code> alongside <code>leaflet-src.js</code>, <code>leaflet.rrose.css</code> and
            <code>leaflet.rrose.ie.css</code> alongside <code>leaflet.css</code>.  Include <code>leaflet.rrose.ie.css</code>
            conditionally, as you are already doing with <code>leaflet.ie.css</code>.  Then, instead of instantiating a
            new L.Popup object, instantiate a new L.Rrose object:
            
            <pre><code>
...

onEachFeature: function(feature,layer){
  layer.on('mouseover', function(e){
    var hover_bubble = new L.Rrose({ offset: new L.Point(0,-10), closeButton: false, autoPan: false })
      .setContent(feature.properties.name)
      .setLatLng(e.latlng)
      .openOn(rrose_map);
  });
  layer.on('mouseout', function(e){ rrose_map.closePopup() });
}

...
            </code></pre>
        </p>

        <p>
            
        </p>

        <h3>Potential Future Work</h3>
        <ul>
            <li>make it look better in IE 8 and earlier</li>
            <li>make the tip pop up to the side for predominantly east (e, ese, ene) or west (w, wsw, wnw) popups</li>
        </ul>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/erictheise">erictheise</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-36924475-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>